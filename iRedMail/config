#!/usr/bin/env bash

# For installation local MySQL set:
# MYSQL_SERVER='127.0.0.1'
# MYSQL_GRANT_HOST='localhost'
HOSTNAME="$(hostname -f)"

export STORAGE_BASE_DIR=${STORAGE_BASE_DIR:-/var/vmail}

export MYSQL_SERVER=${MYSQL_SERVER:-127.0.0.1}
export MYSQL_SERVER_PORT=${MYSQL_SERVER_PORT:-3306}
export MYSQL_GRANT_HOST=${MYSQL_GRANT_HOST:-%}
export MYSQL_ROOT_USER=${MYSQL_ROOT_USER:-root}
export MYSQL_ROOT_PASSWD=${MYSQL_ROOT_PASSWD:-Isadmin123}
export MYSQL_SERVER_DB_NAME=${MYSQL_SERVER_DB_NAME:-'onlyoffice_mailserver'}

export FIRST_DOMAIN=${FIRST_DOMAIN:-${HOSTNAME}}
PWD="$(date +%s | sha256sum | base64 | head -c 12 ; echo)"
export DOMAIN_ADMIN_PASSWD=${DOMAIN_ADMIN_PASSWD:-${PWD}}

export CONFIGURATION_ONLY=${CONFIGURATION_ONLY:-'NO'}
export USE_DOCKER=${USE_DOCKER:-'NO'}

# Only for local MySQL:
export MAIL_DB_EXTERNAL_USER=${MAIL_DB_EXTERNAL_USER:-mail_admin}
export MAIL_DB_EXTERNAL_PASSWD=${MAIL_DB_EXTERNAL_PASSWD:-Isadmin123}
export MAIL_DB_EXTERNAL_GRANT_HOST=${MAIL_DB_EXTERNAL_GRANT_HOST:-''}

# For link with mysql server docker
export MYSQL_SERVER=${MYSQL_SERVER_PORT_3306_TCP_ADDR:-${MYSQL_SERVER}}
export MYSQL_SERVER_PORT=${MYSQL_SERVER_PORT_3306_TCP_PORT:-${MYSQL_SERVER_PORT}}
export MYSQL_ROOT_USER=${MYSQL_SERVER_ENV_MYSQL_USER:-${MYSQL_ROOT_USER}}
export MYSQL_ROOT_PASSWD=${MYSQL_SERVER_ENV_MYSQL_PASSWORD:-${MYSQL_ROOT_PASSWD}}
export VMAIL_DB=${MYSQL_SERVER_ENV_MYSQL_DATABASE:-${MYSQL_SERVER_DB_NAME}}

export VERSION="1.6.75"
export VMAIL_USER_HOME_DIR="${STORAGE_BASE_DIR}"
export STORAGE_MAILBOX_DIR="${STORAGE_BASE_DIR}/vmail1"
export SIEVE_DIR="${STORAGE_BASE_DIR}/sieve"
export BACKUP_DIR="${STORAGE_BASE_DIR}/backup"
export BACKUP_SCRIPT_MYSQL="${STORAGE_BASE_DIR}/backup/backup_mysql.sh"
export BACKEND_ORIG='MYSQL'
export BACKEND='MYSQL'
export SQL_SERVER="${MYSQL_SERVER}"
export SQL_SERVER_PORT="${MYSQL_SERVER_PORT}"
export DOMAIN_ADMIN_NAME='postmaster'
export DOMAIN_ADMIN_PASSWD_PLAIN="${DOMAIN_ADMIN_PASSWD}"
export SITE_ADMIN_NAME="${DOMAIN_ADMIN_NAME}@${FIRST_DOMAIN}"
export SITE_ADMIN_PASSWD="${DOMAIN_ADMIN_PASSWD}"
export FIRST_USER="${DOMAIN_ADMIN_NAME}"
export FIRST_USER_PASSWD="${DOMAIN_ADMIN_PASSWD}"
export FIRST_USER_PASSWD_PLAIN="${DOMAIN_ADMIN_PASSWD}"
export ENABLE_DKIM='YES'
export USE_AWSTATS='YES'
export VMAIL_DB_ADMIN_USER="${MYSQL_ROOT_USER}"
export VMAIL_DB_ADMIN_PASSWD="${MYSQL_ROOT_PASSWD}"
export AMAVISD_DB_NAME="${VMAIL_DB}"
export AMAVISD_DB_USER="${MYSQL_ROOT_USER}"
export AMAVISD_DB_PASSWD="${MYSQL_ROOT_PASSWD}"
export SPAMASSASSIN_DB_NAME="${VMAIL_DB}"
export SPAMASSASSIN_DB_USER="${MYSQL_ROOT_USER}"
export SPAMASSASSIN_DB_PASSWD="${MYSQL_ROOT_PASSWD}"
export CLUEBRINGER_DB_NAME="${VMAIL_DB}"
export CLUEBRINGER_DB_USER="${MYSQL_ROOT_USER}"
export CLUEBRINGER_DB_PASSWD="${MYSQL_ROOT_PASSWD}"
export WEB_SERVER_IS_APACHE='YES'
export WEB_SERVER_IS_NGINX='NO'
#EOF
